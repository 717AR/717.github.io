<script>
    const pdfBaseUrl = 'https://hawaiianair.sharepoint.com/sites/flightoperations/Daily%20Flight%20Schedules/';

    function getFormattedDateForUrl(date) {
        // Make sure to get the date in UTC for proper formatting
        const days = String(date.getUTCDate()).padStart(2, '0'); // Use getUTCDate()
        const month = date.toLocaleString('default', { month: 'short' }).toUpperCase();
        const year = String(date.getUTCFullYear()).slice(-2); // Use getUTCFullYear()
        return `${days}${month}${year}`;
    }

    function displayDate() {
        const today = new Date();
        
        // Convert local time to Hawaii Standard Time (HST)
        const hawaiiTime = new Date(today.toLocaleString("en-US", { timeZone: "Pacific/Honolulu" }));
        const isAfter1600HST = hawaiiTime.getHours() >= 16;

        const tomorrowButton = document.getElementById('tomorrow-button');
        if (isAfter1600HST) {
            tomorrowButton.style.display = 'inline'; // Ensure it is displayed inline
            tomorrowButton.onclick = function() {
                const tomorrowDate = new Date();
                tomorrowDate.setDate(today.getDate() + 1);
                const pdfUrl = `${pdfBaseUrl}${getFormattedDateForUrl(tomorrowDate)}-PI PAX RSV LIST.PDF`;
                window.open(pdfUrl, '_blank');
            };
        }

        document.getElementById('today-button').onclick = function() {
            const pdfUrl = `${pdfBaseUrl}${getFormattedDateForUrl(hawaiiTime)}-PI PAX RSV LIST.PDF`;
            window.open(pdfUrl, '_blank');
        };
    }

    const docSelect = document.getElementById('doc');
    const datePicker = document.getElementById('datepicker');
    const goButton = document.getElementById('go-button');

    docSelect.addEventListener('change', function() {
        const selectedDoc = this.value;

        // Ensure the date picker is visible
        datePicker.style.display = 'inline';

        // Disable the Go button initially
        goButton.disabled = true;
        goButton.classList.add('disabled');
        goButton.classList.remove('enabled');

        if (selectedDoc !== "#" && datePicker.value) {
            // Enable the Go button when both date and document are selected
            goButton.disabled = false;
            goButton.classList.add('enabled');
            goButton.classList.remove('disabled');
        }
    });

    datePicker.addEventListener('change', function() {
        const selectedDoc = docSelect.value;
        const selectedDate = new Date(this.value);  // Use the exact date from the datepicker
        const hawaiiDate = new Date(selectedDate.toLocaleString("en-US", { timeZone: "Pacific/Honolulu" }));  // Adjust for Hawaii time
        const formattedDate = getFormattedDateForUrl(hawaiiDate);

        // Enable the Go button when a valid document and date are selected
        goButton.disabled = !(selectedDoc !== "#" && datePicker.value);
        goButton.classList.toggle('enabled', !goButton.disabled);
        goButton.classList.toggle('disabled', goButton.disabled);
    });

    goButton.addEventListener('click', function() {
        const selectedDoc = docSelect.value;
        const selectedDate = new Date(datePicker.value);

        const hawaiiDate = new Date(selectedDate.toLocaleString("en-US", { timeZone: "Pacific/Honolulu" })); // Adjust for Hawaii time
        let pdfUrl = '';
        const formattedDate = getFormattedDateForUrl(hawaiiDate);

        if (selectedDoc === "RSV") {
            pdfUrl = `${pdfBaseUrl}${formattedDate}-PI PAX RSV LIST.PDF`;
        } else if (selectedDoc === "REC") {
            pdfUrl = `${pdfBaseUrl}${formattedDate}-PI RCL LIST.PDF`;
        } else if (selectedDoc === "DFS") {
            pdfUrl = `${pdfBaseUrl}${formattedDate}-787 DFSH.PDF`;
        }

        if (pdfUrl) {
            window.open(pdfUrl, '_blank');
        }
    });

    displayDate();
</script>
